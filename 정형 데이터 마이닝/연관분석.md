# â­• ì—°ê´€ë¶„ì„

ì—°ê´€ë¶„ì„(Association Analysis)ì€ ê¸°ì—…ì˜ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìƒí’ˆì˜ êµ¬ë§¤, ì„œë¹„ìŠ¤ ë“± ì¼ë ¨ì˜ ê±°ë˜ ë˜ëŠ” ì‚¬ê±´ë“¤ ê°„ì˜ ê·œì¹™ì„ ë°œê²¬í•˜ì—¬ IF-THENì˜ êµ¬ì¡°ë¡œ ë¶„ì„ ê²°ê³¼ì˜ ì—°ê´€ì„±ì„ íŒŒì•…í•˜ëŠ” ë°ì´í„°ë§ˆì´ë‹ ë°©ë²•ë¡ . ì—°ê´€ë¶„ì„ì€ íš¨ìœ¨ì ì¸ ìƒí’ˆ ì§„ì—´, íŒ¨í‚¤ì§€ ìƒí’ˆ ê°œë°œ, êµì°¨íŒë§¤ ì „ëµ, ê¸°íš ìƒí’ˆì˜ ê²°ì • ë“±ì— ì‚¬ìš©ë˜ê³  ìˆë‹¤.

## â— ì—°ê´€ê·œì¹™ë¶„ì„(Association Analysis)ì˜ ê°œë…

- ì—°ê´€ì„± ë¶„ì„ì€ í”íˆ ì¥ë°”êµ¬ë‹ˆ ë¶„ì„(Market Basket Analysis) ë˜ëŠ” ì„œì—´ ë¶„ì„(Sequence Analysis)ì´ë¼ê³  ë¶ˆë¦¼.
- ê¸°ì—…ì˜ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìƒí’ˆì˜ êµ¬ë§¤ , ì„œë¹„ìŠ¤ ë“± ì¼ë ¨ì˜ ê±°ë˜ ë˜ëŠ” ì‚¬ê±´ë“¤ ê°„ì˜ ê·œì¹™ì„ ë°œê²¬í•˜ê¸° ìœ„í•´ ì ìš©.
- ì¥ë°”êµ¬ë‹ˆ ë¶„ì„: 'ì¥ë°”êµ¬ë‹ˆì— ë¬´ì—‡ì´ ê°™ì´ ë“¤ì–´ ìˆëŠ”ì§€ì— ëŒ€í•œ ë¶„ì„'
- ì„œì—´ë¶„ì„: 'Aë¥¼ ì‚° ë‹¤ìŒì— Bë¥¼ ì‚°ë‹¤'(IF THEN)

## â— ì—°ê´€ê·œì¹™ì˜ ì¸¡ë„

ì‚°ì—…ì˜ íŠ¹ì„±ì— ë”°ë¼ ì§€ì§€ë„, ì‹ ë¢°ë„, í–¥ìƒë„ ê°’ì„ ì˜ ë³´ê³  ê·œì¹™ì„ íŒë‹¨

- ì§€ì§€ë„: ì „ì²´ ê±°ë˜ ì¤‘ í•­ëª© Aì™€ í•­ëª© Bë¥¼ ë™ì‹œì— í¬í•¨í•˜ëŠ” ê±°ë˜ ë¹„ìœ¨(êµì§‘í•©í™•ë¥ )
- ì‹ ë¢°ë„: í•­ëª© Aë¥¼ í¬í•¨í•œ ê±°ë˜ì¤‘ í•­ëª© Aì™€ í•­ëª© Bê°€ ê°™ì´ í¬í•¨ë  í™•ë¥ (ì¡°ê±´ë¶€í™•ë¥ )
- í–¥ìƒë„: Aê°€ êµ¬ë§¤ë˜ì§€ ì•Šì•˜ì„ ë–„, í’ˆëª© Bì˜ êµ¬ë§¤í™•ë¥ ì— ë¹„í•´ Aê°€ êµ¬ë§¤ëì„ ë•Œ, í’ˆëª© Bì˜ êµ¬ë§¤í™•ë¥ ì˜ ì¦ê°€ë¹„. ì„œë¡œ ì—°ê´€ì„±ì´ ì—†ëŠ” ê²½ìš° 1ì„ (ì‹ ë¢°ë„* 1/P(B))

## â“ Apriori ì•Œê³ ë¦¬ì¦˜

ìµœì†Œ ì§€ì§€ë„ë³´ë‹¤ í° ì§€ì§€ë„ ê°’ì„ ê°–ëŠ” í’ˆëª©ì˜ ì§‘í•©ì„ ë¹ˆë°œí•­ëª©ì§‘í•©(Frequent Item Set)ì´ë¼ê³  í•¨. Apriori ì•Œê³ ë¦¬ì¦˜ì€ ëª¨ë“  í’ˆëª© ì§‘í•©ì— ëŒ€í•œ ì§€ì§€ë„ë¥¼ ì „ë¶€ ê³„ì‚°í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ìµœì†Œ ì§€ì§€ë„ ì´ìƒì˜ ë¹ˆë°œí•­ëª©ì§‘í•©ì„ ì°¾ì€ í›„ ê·¸ê²ƒë“¤ì— ëŒ€í•´ì„œë§Œ ì—°ê´€ê·œì¹™ì„ ê³„ì‚°í•˜ëŠ” ê²ƒ.

AprioriëŠ” 1994ë…„ì— ë°œí‘œëœ 1ì„¸ëŒ€ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ êµ¬í˜„ê³¼ ì´í•´í•˜ê¸°ê°€ ì‰½ë‹¤ëŠ” ì¥ì ì´ ìˆìŒ. í•˜ì§€ë§Œ ì§€ì§€ë„ê°€ ë‚®ì€ í›„ë³´ ì§‘í•© ìƒì„± ì‹œ ì•„ì´í…œì˜ ê°œìˆ˜ê°€ ë§ì•„ì§€ë©´ ê³„ì‚° ë³µì¡ë„ê°€ ì¦ê°€í•˜ëŠ” ë¬¸ì œì ì„ ê°–ê³  ìˆìŒ.

## â“ Rì—ì„œ ì—°ê´€ë¶„ì„í•˜ëŠ” ë²•

`arules` íŒ¨í‚¤ì§€ì˜  `apriori()` í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ë¶„ì„ ê°€ëŠ¥. ì¦‰ ìµœì†Œ Në²ˆ ì´ìƒ íŠ¸ëœì­ì…˜ì´ ì¼ì–´ë‚œ ì•„ì´í…œì— ëŒ€í•´ì„œ ë¶„ì„ì„ ì§„í–‰.

`apriori()`í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê¸° ì „ì— `as()`í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ íŠ¸ëœì­ì…˜ í˜•íƒœë¡œ ë³€ê²½ í•´ì•¼ í•˜ë©°, `apriori()`ì˜ ë¶„ì„ ê²°ê³¼ëŠ” `inspect()`ë¥¼ í†µí•´ í™•ì¸ ê°€ëŠ¥.

```R
as(data, class, ...)
# data: classë¥¼ ë³€ê²½í•˜ê³ ì í•˜ëŠ” object
# class: objectë¥¼ ë³€ê²½í•  í´ë˜ìŠ¤ ì´ë¦„. ì—°ê´€ë¶„ì„ì€ 'transactions'
```

```R
inspect(x, ...)
# x: ì—°ê´€ê·œì¹™ ë˜”ëŠ íŠ¸ëœì­ì…˜ ë˜ëŠëŠ ì•„ì´í…œ ë§¤íŠ¸ë¦­ìŠ¤ ë°ì´í„°
```

ì‹¤ìŠµ

```R
install.packages('arules')
library('arules')
id = c(1, 2, 3, 4, 5, 6)
gender = c('FEMALE', 'MALE', 'FEMALE', 'FEMALE', 'MALE', 'FEMALE')
age = c('age_20', 'age_20', ' age_40', 'age_30', 'age_40', 'age_30')
rank = c('Gold', 'Silver', 'Silver','VIP', 'Gold', 'Gold')
mobile_app_use = c('Yes', 'Yes', 'NO', 'YES', 'NO', 'YES')
re_order = c('Yes', 'NO', 'NO', 'YES', 'NO', 'YES')
cust_tel = cbind(id, gender, age, rank, mobile_app_use, re_order)
cust_tel = as.data.frame(cust_tel)
cust_tel_1 = subset(cust_tel, select = -c(id))
cust_tel_1
tran_cust = as(cust_tel_1, 'transactions')
tran_cust

transactions in sparse format with
 6 transactions (rows) and
 15 items (columns)

inspect(tran_cust)
    items                                                                 transactionID
[1] {gender=FEMALE,age=age_20,rank=Gold,mobile_app_use=Yes,re_order=Yes}  1            
[2] {gender=MALE,age=age_20,rank=Silver,mobile_app_use=Yes,re_order=NO}   2            
[3] {gender=FEMALE,age= age_40,rank=Silver,mobile_app_use=NO,re_order=NO} 3            
[4] {gender=FEMALE,age=age_30,rank=VIP,mobile_app_use=YES,re_order=YES}   4            
[5] {gender=MALE,age=age_40,rank=Gold,mobile_app_use=NO,re_order=NO}      5            
[6] {gender=FEMALE,age=age_30,rank=Gold,mobile_app_use=YES,re_order=YES}  6   
```

ë°ì´í„°í”„ë ˆì„ì„ as í•¨ìˆ˜ë¡œ transactioní˜•íƒœë¡œ ë³€í™˜í•˜ì˜€ìœ¼ë©°, ë³€í™˜ëœ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ë©´ ë°ì´í„°ì˜ í–‰ê³¼ ì—´ì˜ ê°œìˆ˜ë§Œ ë‚˜íƒ€ëƒ„. inspectí•¨ìˆ˜ë¡œ íŠ¸ëœì­ì…˜ ë°ì´í„°ë¡œ ë³€í™˜ëœ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŒ.

ë³¸ê²©ì ìœ¼ë¡œ Groceries ë°ì´í„°ì…‹ìœ¼ë¡œ ì—°ê´€ê·œì¹™ë¶„ì„ì„ ì‹¤ìŠµ!

```R
apriori(data, parameter, appearance, control)
# data: ì—°ê´€ê·œì¹™ ë˜ëŠ” íŠ¸ëœì­ì…˜ ë˜ëŠ” ì•„ì´í…œ ë§¤íŠ¸ë¦­ìŠ¤ ë°ì´í„°
# parameter: ìµœì†Œ ì§€ì§€ë„(support),
#                ì‹ ë¢°ë„(conf),
#                ìµœëŒ€ ì•„ì´í…œ ê°œìˆ˜(maxlen),
#                ìµœì†Œ ì•„ì´í…œ ê°œìˆ˜ ì…ë ¥(minlen)
```

```R
data("Groceries")
Groceries
inspect(Groceries[1:3]) # inspect í•¨ìˆ˜ëŠ” transaction ë°ì´í„°ì™€ ì—°ê´€ê·œì¹™ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•œ í•¨ìˆ˜.
    items                
[1] {citrus fruit,       
     semi-finished bread,
     margarine,          
     ready soups}        
[2] {tropical fruit,     
     yogurt,             
     coffee}             
[3] {whole milk}         

rules = apriori(Groceries, parameter = list(support = 0.01,
                                            confidence = 0.3)) # parameterë¥¼ ì…ë ¥í•  ë•Œ list()í˜•ì‹ìœ¼ë¡œ ì…ë ¥
Apriori

Parameter specification:
 confidence minval smax arem  aval originalSupport maxtime support minlen maxlen target  ext
        0.3    0.1    1 none FALSE            TRUE       5    0.01      1     10  rules TRUE

Algorithmic control:
 filter tree heap memopt load sort verbose
    0.1 TRUE TRUE  FALSE TRUE    2    TRUE

Absolute minimum support count: 98 

set item appearances ...[0 item(s)] done [0.00s].
set transactions ...[169 item(s), 9835 transaction(s)] done [0.01s].
sorting and recoding items ... [88 item(s)] done [0.00s].
creating transaction tree ... done [0.00s].
checking subsets of size 1 2 3 4 done [0.00s].
writing ... [125 rule(s)] done [0.00s].
creating S4 object  ... done [0.00s].
```

parameterê°’ì„ ìµœì†Œì§€ì§€ë„ëŠ” 0.01, ì‹ ë¢°ë„ëŠ” 0.3ìœ¼ë¡œ ì§€ì • ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í–ˆì„ ë•Œ, 125 rulesë¥¼ í†µí•´ ì´ 125ê°œì˜ ì—°ê´€ê·œì¹™ì´ ìƒì„±ë˜ì—ˆìŒì„ ì•Œ ìˆ˜ ìˆìŒ.

patameter specificationì„ í†µí•´ êµ¬ì²´ì ì¸ ë§¤ê°œë³€ìˆ˜ ê°’ì„ í™•ì¸í•  ìˆ˜ ìˆê³  ê·œì¹™ì˜ ìˆ˜ì— ë”°ë¼ ì§€ì§€ë„ì™€ ì‹ ë¢°ë„ë¥¼ ë†’ì´ê±°ë‚˜ ë‚®ì¶”ì–´ ê·œì¹™ì„ ì¡°ì •í•  ìˆ˜ ìˆìŒ.

```R
# ì—°ê´€ê·œì¹™ë¶„ì„ í™•ì¸
inspect(sort(rules, by = c('confidence'), decreasing = T)[1:5])
    lhs                                 rhs                support    confidence coverage   lift     count
[1] {citrus fruit,root vegetables}   => {other vegetables} 0.01037112 0.5862069  0.01769192 3.029608 102  
[2] {tropical fruit,root vegetables} => {other vegetables} 0.01230300 0.5845411  0.02104728 3.020999 121  
[3] {curd,yogurt}                    => {whole milk}       0.01006609 0.5823529  0.01728521 2.279125  99  
[4] {other vegetables,butter}        => {whole milk}       0.01148958 0.5736041  0.02003050 2.244885 113  
[5] {tropical fruit,root vegetables} => {whole milk}       0.01199797 0.5700483  0.02104728 2.230969 118

# ì¤‘ë³µê°€ì§€ì¹˜ê¸° í•¨ìˆ˜ êµ¬í˜„ ğŸ’¢ğŸ’¢ğŸ’¥ğŸ’¥
prune.dup.rules = function(rulse) {
  rule_subset_matrix = is.subset(rules, rules, sparse = F)
  rule_subset_matrix[lower.tri(rule_subset_matrix, diag = T)] = NA
  dup_rules = colSums(rule_subset_matrix, na.rm = T) >= 1
  pruned_rules = rules[!dup_rules]
  return(pruned_rules)
}
```

`sort()`ë¥¼ í†µí•´ `confidence`ì— ë”°ë¼ ë‚´ë¦¼ì°¨ìˆœ ì •ë¦¬í–ˆìœ¼ë©°, 1~5ìœ„ê¹Œì§€ì˜ ì—°ê´€ê·œì¹™ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. lhsëŠ” ì¢Œí•­, rhsëŠ” ìš°í•­ì„ ëœ»í•˜ê³  ì¢Œí•­ì„ êµ¬ë§¤í–ˆì„ ë•Œ, ìš°í•­ì„ êµ¬ë§¤í•˜ëŠ” ê·œì¹™ì„ ëœ»í•¨. ê°ê°ì˜ ì§€ì§€ë„, ì‹ ë¢°ë„, í–¥ìƒë„ë„ í™•ì¸ì´ ê°€ëŠ¥í•˜ë©°, countëŠ” í•´ë‹¹ êµ¬ì¹™ì˜ ê°œìˆ˜ë¥¼ ì˜ë¯¸í•¨.

í•´ë‹¹ ê·œì¹™ì—ì„œ `confidence`ê°€ ë†’ë‹¤ëŠ” ëœ»ì€ êµ¬ë§¤ í’ˆëª©ë“¤ì˜ ì—°ê´€ì„±ì´ ë†’ìŒì„ ëœ»í•˜ë©°, liftê°€ ë†’ë‹¤ëŠ” ëœ»ì€ ì¢Œí•­ì˜ ì œí’ˆì„ êµ¬ë§¤í•  ë•Œ, ìš°í•­ì˜ ì œí’ˆì„ êµ¬ë§¤í•  í™•ë¥ ì´ ì•½ në°° ê°€ëŸ‰ ë†’ìŒì„ ëœ»í•¨.

ì¢Œí•­ì—ì„œ ìš°í•­, ìš°í•­ì—ì„œ ì¢Œí•­ì˜ ê·œì¹™ì´ ê²¹ì¹˜ëŠ” ê²½ìš°ê°€ ìˆìœ¼ë¯€ë¡œ, ì¤‘ë³µ ê·œì¹™ì€ ì—†ì• ì•¼ í•œë‹¤. arules íŒ¨í‚¤ì§€ì—ì„œëŠ” ì¤‘ë³µ ê°€ì§€ì¹˜ê¸° í•¨ìˆ˜ë¥¼ ì œê³µí•˜ì§€ ì•Šì•„ í•¨ìˆ˜ë¥¼ ì§ì ‘ êµ¬í˜„ ğŸ’¢ğŸ’¢ğŸ’¥ğŸ’¥

```R
metric_params = list(supp = 0.001, conf = 0.5, minlen = 2)
rules = apriori(data = Groceries, parameter = metric_params,
                appearance = list(default = 'lhs', rhs = 'soda'), #  lhsëŠ” ì¢Œí•­, rhsëŠ” ìš°í•­ì„ ëœ» ìš°í•­ ì •í•  ë•Œ í•­ëª©ì„ ë¯¸ë¦¬ í™•ì¸í•˜ì.
                control = list(verbose = T))
rules = prune.dup.rules(rules)
rules = sort(rules, decreasing = T, by = 'confidence')

inspect(rules[1:5])
    lhs                                     rhs    support     confidence coverage    lift     count
[1] {coffee,misc. beverages}             => {soda} 0.001016777 0.7692308  0.001321810 4.411303 10   
[2] {sausage,bottled water,bottled beer} => {soda} 0.001118454 0.7333333  0.001525165 4.205442 11   
[3] {sausage,white bread,shopping bags}  => {soda} 0.001016777 0.6666667  0.001525165 3.823129 10   
[4] {rolls/buns,bottled water,chocolate} => {soda} 0.001321810 0.6500000  0.002033554 3.727551 13   
[5] {pastry,misc. beverages}             => {soda} 0.001220132 0.6315789  0.001931876 3.621912 12 
```

parameterë¥¼ ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ì €ì¥í•˜ì—¬ apriori í•¨ìˆ˜ì— ì ìš©í–ˆìœ¼ë©°, appearanceë¥¼ í†µí•´ ìš°ì¸¡ì˜ sodaë¥¼ ì‚¬ê¸° ìœ„í•´ ì¢Œí•­ì˜ ì•„ì´í…œì„ ì°¾ëŠ” ê²ƒìœ¼ë¡œ ì„¤ì •í–ˆë‹¤. control ì¸ìì—ì„œ verboseëŠ” apriorií•¨ìˆ˜ ì‹¤í–‰ ê²°ê³¼ë¥¼ ë‚˜íƒ€ë‚¼ì§€ì˜ ì—¬ë¶€ë¥¼ ë¬»ëŠ” ì¸ìë¡œ F(FALSE)ë¡œ ì§€ì •í•˜ì—¬ ë‚˜íƒ€ë‚´ì§€ ì•Šê²Œ í•¨.

ìƒì„±ëœ ê·œì¹™ì„ ì¤‘ë³µ ê·œì¹™ ê°€ì§€ì¹˜ê¸°ë¥¼ ì‹¤ì‹œí•˜ê³ , confidenceë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ê²°ê³¼ë¥¼ í™•ì¸. ë¶„ì„ ê²°ê³¼ì—ì„œ coffeeì™€ misc.beveragesë¥¼ í•¨ê»˜ êµ¬ë§¤í•  ê²½ìš° sodaë¥¼ êµ¬ë§¤í•œë‹¤ëŠ” ê·œì¹™ì˜ confidenceê°€ ê°€ì¥ ë†’ê²Œ ë‚˜íƒ€ë‚¬ë‹¤.

```R
metric_params = list(supp = 0.001, conf = 0.3, minlen = 2)
rules = apriori(data = Groceries, parameter = metric_params,
                appearence = list(default = 'rhs',lhs = c('yogurt', 'sugar')),
                control = list(verbose = T))
rules = prune.dup.rules(rules)
rules = sort(rules, decreasing = T, by = 'confidence')
inspect(rules[1:5])
# ë²„ì „ì´ ë§ì§€ ì•Šì•„ í•¨ìˆ˜ê°€ ëŒì•„ê°€ì§€ ì•Šì€ ë¶ˆì‚¬ìƒê°€ ë°œìƒ... í•˜ë£¨ ë¹¨ë¦¬ ê³ ì³ì§€ê¸¸...
```

